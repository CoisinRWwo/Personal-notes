## 1、函数定义

函数是组织好的、可重复使用的、用于执行指定任务的代码块。本文介绍了Go 语言中函数的相关内容。

Go 语言中支持：函数、匿名函数和闭包 

Go 语言中定义函数使用 func 关键字，具体格式如下：

```go
func 函数名(参数)(返回值){
	函数体
}
```

其中：

• 函数名：由字母、数字、下划线组成。但函数名的第一个字母不能是数字。在同一个包内，函数名也称不能重名（包的概念详见后文）。

• 参数：参数由参数变量和参数变量的类型组成，多个参数之间使用,分隔。

• 返回值：返回值由返回值变量和其变量类型组成，也可以只写返回值的类型，多个返回值必须用()包裹，并用,分隔。

• 函数体：实现指定功能的代码块。



我们先来定义一个求两个数之和的函数：

```go
func intSum(x int, y int) int {
	return x + y
}
```

函数的参数和返回值都是可选的，例如我们可以实现一个既不需要参数也没有返回值的函数：

```go
func sayHello() {
fmt.Println("Hello it 营")
}
```



## 2、函数的调用

定义了函数之后，我们可以通过函数名()的方式调用函数。 例如我们调用上面定义的两个函数，代码如下：

```go
func main() {
    sayHello()
    ret := intSum(10, 20)
    fmt.Println(ret)
}
```

注意，调用有返回值的函数时，可以不接收其返回值。



## 3、函数参数

**类型简写**

函数的参数中如果相邻变量的类型相同，则可以省略类型，例如：

```go
func intSum(x, y int) int {
    return x + y
}
```

上面的代码中，intSum 函数有两个参数，这两个参数的类型均为 int，因此可以省略x 的类型，因为 y 后面有类型说明，x 参数也是该类型。



**可变参数**

可变参数是指函数的参数数量不固定。Go 语言中的可变参数通过在参数名后加...来标识。

**注意**：可变参数通常要作为函数的最后一个参数。

举个例子：

```go
func intSum2(x ...int) int {
    fmt.Println(x) //x 是一个切片
    sum := 0
    for _, v := range x {
    	sum = sum + v
	}
	return sum
}

调用上面的函数：
ret1 := intSum2()
ret2 := intSum2(10)
ret3 := intSum2(10, 20)
ret4 := intSum2(10, 20, 30)
fmt.Println(ret1, ret2, ret3, ret4) //0 10 30 60
```

固定参数搭配可变参数使用时，可变参数要放在固定参数的后面，示例代码如下：

```go
func intSum3(x int, y ...int) int {
    fmt.Println(x, y)
    sum := x
    for _, v := range y {
    	sum = sum + v
    }
    return sum
}

调用上述函数：
ret5 := intSum3(100)
ret6 := intSum3(100, 10)
ret7 := intSum3(100, 10, 20)
ret8 := intSum3(100, 10, 20, 30)
fmt.Println(ret5, ret6, ret7, ret8) //100 110 130 160
```

本质上，函数的可变参数是通过切片来实现的。



## 4、函数返回值

Go 语言中通过 return 关键字向外输出返回值。



**函数多返回值**

Go 语言中函数支持多返回值，函数如果有多个返回值时必须用()将所有返回值包裹起来。举个例子：

```go
func calc(x, y int) (int, int) {
    sum := x + y
    sub := x - y
    return sum, sub
}
```

**返回值命名** 

函数定义时可以给返回值命名，并在函数体中直接使用这些变量，最后通过return 关键字返回。

例如：

```go
func calc(x, y int) (sum, sub int) {
    sum = x + y
    sub = x - y
    return
}
```



## 5、函数变量作用域

**全局变量**

全局变量是定义在函数外部的变量，它在程序整个运行周期内都有效。在函数中可以访问到全局变量。

```go
package main
import "fmt"

//定义全局变量 num
var num int64 = 10

func testGlobalVar() {
	fmt.Printf("num=%d\n", num) //函数中可以访问全局变量 num
}

func main() {
    testGlobalVar() //num=10
}
```



**局部变量**

局部变量是函数内部定义的变量， 函数内定义的变量无法在该函数外使用



**1、函数内定义的变量无法在该函数外使用**

例如下面的示例代码 main 函数中无法使用 testLocalVar 函数中定义的变量x：

```go
func testLocalVar() {
    //定义一个函数局部变量 x,仅在该函数内生效
    var x int64 = 100
    fmt.Printf("x=%d\n", x)
}

func main() {
    testLocalVar()
    fmt.Println(x) // 此时无法使用变量 x
}
```



**2、如果局部变量和全局变量重名，优先访问局部变量**

```go
package main
import "fmt"
//定义全局变量 num
var num int64 = 10
func testNum() {
    num := 100
    fmt.Printf("num=%d\n", num) // 函数中优先使用局部变量
}

func main() {
    testNum() // num=100
}
```

接下来我们来看一下语句块定义的变量，通常我们会在 if 条件判断、for 循环、switch 语句上使用这种定义变量的方式。

```go
func testLocalVar2(x, y int) {
    fmt.Println(x, y) //函数的参数也是只在本函数中生效
    if x > 0 {
        z := 100 //变量 z 只在 if 语句块生效
        fmt.Println(z)
    }
    //fmt.Println(z)//此处无法使用变量 z
}
```

还有我们之前讲过的 for 循环语句中定义的变量，也是只在 for 语句块中生效：

```go
func testLocalVar3() {
    for i := 0; i < 10; i++ {
    	fmt.Println(i) //变量 i 只在当前 for 语句块中生效
    }
    //fmt.Println(i) //此处无法使用变量 i
}
```





## 6、函数类型与变量



**定义函数类型**

我们可以使用 type 关键字来定义一个函数类型，具体格式如下：

```go
type calculation func(int, int) int
```

上面语句定义了一个 calculation 类型，它是一种函数类型，这种函数接收两个int 类型的参数并且返回一个 int 类型的返回值。

简单来说，凡是满足这个条件的函数都是 calculation 类型的函数，例如下面的add 和sub是calculation 类型。

```go
func add(x, y int) int {
	return x + y
}

func sub(x, y int) int {
	return x - y
}
```

add 和 sub 都能赋值给 calculation 类型的变量。

```go
var c calculation
c = add
```



**函数类型变量**

我们可以声明函数类型的变量并且为该变量赋值：

```go
func main() {
    var c calculation // 声明一个 calculation 类型的变量c
    c = add // 把 add 赋值给 c
    fmt.Printf("type of c:%T\n", c) // type of c:main.calculation
    fmt.Println(c(1, 2)) // 像调用 add 一样调用 c
    
    f := add // 将函数 add 赋值给变量 f1
    fmt.Printf("type of f:%T\n", f) // type of f:func(int, int) int
    fmt.Println(f(10, 20)) // 像调用 add 一样调用 f
}
```

